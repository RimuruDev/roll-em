<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ROLL'EM</title>

    <meta name="viewport"
          content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes" />

    <link rel="icon" href="TemplateData/game-logo.png" type="image/png">
    <link rel="preload" as="image" href="TemplateData/game-logo.png">

    <link rel="stylesheet" href="TemplateData/style.css" />
</head>
<body>
<div id="unity-container">
    <canvas id="unity-canvas" width=960 height=600 tabindex="-1"></canvas>

    <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
            <div id="unity-progress-bar-full"></div>
        </div>
    </div>

    <div id="unity-warning"></div>

    <button id="fullscreen-btn" aria-label="Fullscreen"></button>
</div>

<script>
    const canvas       = document.getElementById("unity-canvas");
    const loading      = document.getElementById("unity-loading-bar");
    const progressFull = document.getElementById("unity-progress-bar-full");

    function unityShowBanner(msg, type) {
      const warning = document.getElementById("unity-warning");
      const d = document.createElement('div');
      d.textContent = msg;
      d.style.background = (type === 'error') ? '#ff6161' : '#ffd800';
      d.style.padding = '6px 10px';
      d.style.margin = '4px 0';
      d.style.borderRadius = '4px';
      warning.appendChild(d);
      warning.style.display = 'block';
      if (type !== 'error') setTimeout(() => {
        warning.removeChild(d);
        if (!warning.children.length) warning.style.display = 'none';
      }, 5000);
    }

    const buildUrl  = "Build";
    const loaderUrl = buildUrl + "/20a3f1e73031f0531e657ebb977cd977.loader.js";

    const config = {
      dataUrl:      buildUrl + "/31ad2843bd50fd26e5b458172a4f92b1.data.unityweb",
      frameworkUrl: buildUrl + "/f47ee477e0c733eed1f76cc4d8ea865c.framework.js.unityweb",
      codeUrl:      buildUrl + "/f8530759c2606093dea0d1c2f3a7c085.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName:   "foX_Void",
      productName:   "ROLL'EM",
      productVersion:"1.8.17",
      showBanner: unityShowBanner
    };

    loading.style.display = "flex";

    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, p => {
        progressFull.style.width = (100 * p) + "%";
      }).then(unityInstance => {
        loading.style.display = "none";

        function unlockAudio() {
          try {
            const ac =
              unityInstance.audioContext ||
              (unityInstance.Module && (unityInstance.Module.webAudioContext || unityInstance.Module.audioContext));
            if (ac && ac.state !== 'running') ac.resume();
          } catch (e) {}

          try { unityInstance.SendMessage('GameMaster', 'OnAudioUnlocked'); } catch (e) {}

          window.removeEventListener('pointerdown', unlockAudio, true);
          window.removeEventListener('keydown',     unlockAudio, true);
          window.removeEventListener('touchstart',  unlockAudio, true);
        }
        window.addEventListener('pointerdown', unlockAudio, true);
        window.addEventListener('keydown',     unlockAudio, true);
        window.addEventListener('touchstart',  unlockAudio, true);

        const fs = document.getElementById("fullscreen-btn");
        if (fs) fs.onclick = () => unityInstance.SetFullscreen(1);

      }).catch(message => alert(message));
    };
    document.body.appendChild(script);
</script>
</body>
</html>
